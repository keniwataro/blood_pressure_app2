# AWSデプロイ手順 Part 2: VPC・ネットワーク構築

## 目次
1. VPC作成
2. サブネット作成
3. インターネットゲートウェイ設定
4. NATゲートウェイ設定
5. ルートテーブル設定
6. セキュリティグループ作成

---

## 1. VPC作成

### 1-1. VPCの作成
1. AWSコンソールで「VPC」を検索して開く
2. 左メニュー「VPC」→「VPCを作成」
3. 以下を入力:
   - **作成するリソース**: VPCなど
   - **名前タグ**: `blood-pressure`
   - **IPv4 CIDR**: `10.0.0.0/16`
   - **IPv6 CIDR ブロック**: IPv6 CIDR ブロックなし（デフォルト）
   - **アベイラビリティーゾーン (AZ) の数**: 2
   - **パブリックサブネットの数**: 2
   - **プライベートサブネットの数**: 2
   - **NAT ゲートウェイ ($) - 更新しました**:Zonal
   - **NATゲートウェイ**: 1つのAZ
   - **VPCエンドポイント**: なし
   - **DNS オプション**: DNS ホスト名を有効化、DNS 解決を有効化（両方チェック）
4. 「VPCを作成」をクリック

> **補足: DNS オプションについて**  
> 両方のチェックを有効にしたままで問題ありません。これらはALBやRDSなどのAWSサービスがDNS名で通信するために必要です。

> **補足: IPv6について**  
> このプロジェクトではIPv4のみで問題ありません。IPv6が必要になるのは、グローバルなIPv6対応が必須の場合や大規模システムでIPv4アドレス枯渇の懸念がある場合です。後から必要になった場合でもVPCにIPv6 CIDRブロックを追加可能です。

**これで以下が自動作成されます:**
- VPC
- パブリックサブネット × 2
- プライベートサブネット × 2
- インターネットゲートウェイ
- NATゲートウェイ
- ルートテーブル

---

## 2. セキュリティグループ作成

### 2-1. ALB用セキュリティグループ
1. 左メニュー「セキュリティグループ」→「セキュリティグループを作成」
2. 以下を入力:
   - **セキュリティグループ名**: `blood-pressure-alb-sg`
   - **説明**: `Security group for ALB`
   - **VPC**: `blood-pressure-vpc`を選択
3. インバウンドルール:
   - 「ルールを追加」をクリック
   - **タイプ**: HTTP
   - **ソース**: Anywhere-IPv4 → 0.0.0.0/0
   - 「ルールを追加」をクリック
   - **タイプ**: HTTPS
   - **ソース**: Anywhere-IPv4 → 0.0.0.0/0
4. 「セキュリティグループを作成」

### 2-2. ECS用セキュリティグループ
1. 「セキュリティグループを作成」
2. 以下を入力:
   - **セキュリティグループ名**: `blood-pressure-ecs-sg`
   - **説明**: `Security group for ECS tasks`
   - **VPC**: `blood-pressure-vpc`を選択
3. インバウンドルール:
   - 「ルールを追加」
   - **タイプ**: カスタムTCP
   - **ポート範囲**: 3000
   - **ソース**: カスタム → `blood-pressure-alb-sg`を選択
4. 「セキュリティグループを作成」

### 2-3. RDS用セキュリティグループ
1. 「セキュリティグループを作成」
2. 以下を入力:
   - **セキュリティグループ名**: `blood-pressure-rds-sg`
   - **説明**: `Security group for RDS`
   - **VPC**: `blood-pressure-vpc`を選択
3. インバウンドルール:
   - 「ルールを追加」
   - **タイプ**: PostgreSQL
   - **ポート範囲**: 5432
   - **ソース**: カスタム → `blood-pressure-ecs-sg`を選択
4. 「セキュリティグループを作成」

---

## 3. 作成されたリソースの確認

### 3-1. サブネット確認
1. 左メニュー「サブネット」
2. 以下が作成されていることを確認:
   - パブリックサブネット（2つ、異なるAZ）
   - プライベートサブネット（2つ、異なるAZ）

### 3-2. ルートテーブル確認
1. 左メニュー「ルートテーブル」
2. 画面右上の「更新」ボタン（🔄）をクリック
3. 以下が作成されていることを確認:
   - **パブリックサブネット用ルートテーブル** × 1
     - 名前に「public」が含まれる
     - ルート: `0.0.0.0/0` → インターネットゲートウェイ（igw-xxx）
   - **プライベートサブネット用ルートテーブル** × 2
     - 名前に「private」が含まれる
     - ルート: `0.0.0.0/0` → NATゲートウェイ（nat-xxx）

> **補足**: ルートテーブルが表示されない場合は、画面右上の「更新」ボタンをクリックしてください。VPC作成直後は反映に数秒かかる場合があります。

---

## 次のステップ

VPC構築が完了したら、次のファイル「AWS_DEPLOY_03_RDS構築.md」に進んでください。
